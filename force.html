<!DOCTYPE html>

<html>

  <head>
    <title>Robotic Manipulation: Force Control</title>
    <meta name="Robotic Manipulation: Force Control" content="text/html; charset=utf-8;" />
    <link rel="canonical" href="http://manipulation.csail.mit.edu/force.html" />

    <script src="https://hypothes.is/embed.js" async></script>
    <script type="text/javascript" src="htmlbook/book.js"></script>

    <script src="htmlbook/mathjax-config.js" defer></script> 
    <script type="text/javascript" id="MathJax-script" defer
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
    </script>
    <script>window.MathJax || document.write('<script type="text/javascript" src="htmlbook/MathJax/es5/tex-chtml.js" defer><\/script>')</script>

    <link rel="stylesheet" href="htmlbook/highlight/styles/default.css">
    <script src="htmlbook/highlight/highlight.pack.js"></script> <!-- http://highlightjs.readthedocs.io/en/latest/css-classes-reference.html#language-names-and-aliases -->
    <script>hljs.initHighlightingOnLoad();</script>

    <link rel="stylesheet" type="text/css" href="htmlbook/book.css" />
  </head>

<body onload="loadChapter('manipulation');">

<div data-type="titlepage">
  <header>
    <h1><a href="index.html" style="text-decoration:none;">Robotic Manipulation</a></h1>
    <p data-type="subtitle">Perception, Planning, and Control</p> 
    <p style="font-size: 18px;"><a href="http://people.csail.mit.edu/russt/">Russ Tedrake</a></p>
    <p style="font-size: 14px; text-align: right;"> 
      &copy; Russ Tedrake, 2020<br/>
      Last modified <span id="last_modified"></span>.</br>
      <script>
      var d = new Date(document.lastModified);
      document.getElementById("last_modified").innerHTML = d.getFullYear() + "-" + (d.getMonth()+1) + "-" + d.getDate();</script>
      <a href="misc.html">How to cite these notes, use annotations, and give feedback.</a><br/>
    </p>
  </header>
</div>

<p><b>Note:</b> These are working notes used for <a
href="http://manipulation.csail.mit.edu/Fall2020/">a course being taught
at MIT</a>. They will be updated throughout the Fall 2020 semester.  <!-- <a 
href="https://www.youtube.com/channel/UChfUOAhz7ynELF-s_1LPpWg">Lecture  videos are available on YouTube</a>.--></p> 

<table style="width:100%;"><tr style="width:100%">
  <td style="width:33%;text-align:left;"><a class="previous_chapter" href=segmentation.html>Previous Chapter</a></td>
  <td style="width:33%;text-align:center;"><a href=index.html>Table of contents</a></td>
  <td style="width:33%;text-align:right;"><a class="next_chapter" href=drake.html>Next Chapter</a></td>
</tr></table>


<!-- EVERYTHING ABOVE THIS LINE IS OVERWRITTEN BY THE INSTALL SCRIPT -->
<chapter style="counter-reset: chapter 6"><h1>Force Control</h1>

  <p>Over the last few chapters, we've developed a great initial toolkit for
  perceiving objects (or piles of objects) in a scene, planning grasps, and
  moving the arm to grasp.  But there is a lot more to manipulation than
  grasping!</p>

  <p>In fact, the signs have already been there if you were paying close
  attention.  I'm sure that you noticed image number 9954 in my clutter
  segmentation dataset.  Good old <code>09954.png</code>. Just in case you
  happened to miss it, here it is again.</p>

  <figure><img style="width:60%" src="data/09954.png"/></figure>

  <p>I don't know how many of the other 9999 random scenes that we generated are
  going to have this problem, but 9954 makes it nice and clear.  How in the
  world are we going to pick up that "Cheez-it" cracker box with our
  two-fingered gripper?  (I know there are a few of you out there thinking about
  how easy that scene is for your suction gripper, but suction alone isn't going
  to solve all of our problems either.)</p>

  <figure><<iframe width="560" height="315"
  src="https://www.youtube.com/embed/XqRczI4Fepk?mute=1&rel=0" frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope;
  picture-in-picture" allowfullscreen></iframe><figcaption>Just for fun, I asked
  my daughter to try a similar task with the "two-fingered gripper" I scrounged
  from my kitchen. How are we to program something like
  that!</figcaption></figure>

  <p>The term <i>nonprehensile manipulation</i> means "manipulation without
  grasping", and humans do it often.  It is easy to appreciate this fact when we
  think about pushing an object that is too big to grasp (e.g. an office chair).
  But if you pay close attention, you will see that humans make use of
  strategies like sliding and environmental contact often, even when they are
  grasping. These strategies just come to the forefront in non-grasping
  manipulation.</p>

  <p>As we build up our toolkit for prehensile and nonprehensile manipulation,
  one of the things that is missing from our discussion so far, which has been
  predominantly kinematic, has been thinking about forces.  This chapter aims to
  begin that discussion.  By the end, I hope you'll agree that we have a pretty
  satisfying way to flip up that box!</p>

  <section><h1>A simple model</h1>
  
    <p>As always in our battle against complexity, I want to find a setup that
    is as simple as possible (but no simpler)!  Here is my proposal for the
    box-flipping example.  First, I will restrict all motion to a 2D plane; this
    allows me to chop off two sides of the bin (for you to easily see inside),
    but also drops the number of degrees of freedom we have to consider.  In
    particular, we can avoid the quaternion floating base coordinates, by adding
    a <code>PlanarJoint</code> to the box.  Instead of using a complete gripper,
    let's start even simpler and just use a "point finger".  I've visualized it
    as a small sphere, and modeled two control inputs as providing force
    directly on the $x$ and $z$ coordinates of the point mass.</p>

    <figure><img style="width:60%"
    src="data/point_finger_cracker_box.png"/><figcaption>The simple model: a
    point finger, a cracker box, and the bin all in 2D.  The green arrows are
    the contact forces.</figcaption></figure>

    <p>Even in this simple model, and throughout the discussions in this
    chapter, we will have two dynamic models that we care about.  The first is
    the full dynamic model used for simulation: it contains the finger, the box,
    and the bin, and has a total of 5 degrees of freedom ($x, z, \theta$ for the
    box and $x, z$ for the finger).  The second is the robot model used for
    designing the controllers: this model has just the two degrees of freedom of
    the finger, and experiences unmodelled contact forces.  By design, the
    equations of this second model are particularly simple: $$\begin{bmatrix}m &
    0 \\ 0 & m \end{bmatrix} \dot{v} = m \begin{bmatrix}\ddot{x} \\ \ddot{z}
    \end{bmatrix} = -mg + \begin{bmatrix} u_x \\ u_z \end{bmatrix} + f^c,$$
    where $m$ is the mass, $g$ is the gravity vector, $u$ is the control input
    vector, and $f^c$ is the contact force.  Notably absent is the contact
    Jacobian which normally pre-multiplies the contact forces $\sum_i J_i^T
    f^{c_i};$ in the case of a point finger this Jacobian is always the identity
    matrix, and there is only one point at which contact can be made, so there
    is no meaningful reason to distinguish between multiple forces.</p>

    <subsection><h1>(Direct) force control</h1>

      <p>Almost always, we implement a low-level controller that converts some
      more intuitive command interface down into the generalized force inputs on
      the robot.  In the case of direct force control, the abstraction that we
      want is to be able to directly "control" the contact forces.  (In the
      general case, we must specify the contact location to provide this
      interface; again the point finger allows us to ignore that detail for the
      moment).</p>
      
      <div>
        <script type="text/javascript">
        var force_control = { "name": "ForceControl", 
          "input_ports" : ["desired_contact_force", "robot_state", "robot_accelerations OR &nbsp; &nbsp; &nbsp;<br/> measured_contact_force"],
          "output_ports" : ["robot_actuation"]
          };
        document.write(system_html(force_control));
        </script>
      </div>

      <p>Let us assume that the robot is already in contact.  What information
      do we need to regulate the contact forces?  Certainly we need the desired
      contact force, $f^{c_d}$.  In general, we will need the robot's state
      (though in the immediate example, the dynamics of our point mass are not
      state dependent).  But we also need to either (1) measure the robot
      accelerations (which we've tried to avoid), (2) assume the robot
      accelerations are zero, or (3) provide a measurement of the contact force
      so that we can regulate it with feedback.</p>
      
      <p>Assuming that the accelerations are (nearly) zero is not a horrible
      assumption (if we are already in contact) for most manipulation tasks,
      where the movements are relatively slow.  Let's assume it for now, and
      revisit the assumption later.  In this case, our equations of motion
      reduce to $$f^c = mg - u.$$  Our force controller implementation can be as
      simple as $u = -mg - f^{c_d}.$  This assumes only that we know the mass of
      the robot.</p>

      <p>What happens when the robot is not in contact?  In this case, we cannot
      reasonably ignore the accelerations, and applying the same control results
      in $m\dot{v} = - f^{c_d}.$  That's not all bad.  In fact, it's one of the
      defining features of force control that makes it very appealing.  When you
      specify a desired force and don't get it, the result is accelerating the
      contact point in the (opposite) direction of the desired force.  In
      practice, this (locally) tends to bring you into contact when you are not
      in contact.</p>

      <example><h1>Commanding a constant force</h1>

        <p>Let's see what happens when we run a full simulation which includes
        not only the non-contact case and the contact case, but also the
        transition between the two (which involves collision dynamics).  I'll
        start the point finger next to the box, and apply a constant force
        command requesting to get a horizontal contact force from the box.  I've
        drawn the $x$ trajectory of the finger for different (constant) contact
        force commands.</p>

        <figure><img style="margin-top:-20px; width:70%"
        src="data/constant_force_box.svg"><figcaption>This is a plot of the
        horizontal position of the finger as a function of time, given different
        constant desired force commands.</figcaption></figure>
        
        <p>For all strictly positive desired force commands,
        the finger will accelerate at a constant rate until it collides with the
        box (at $x=0.089$).  For small $f^{c_d}$, the box barely moves.  For an
        intermediate range of $f^{c_d}$, the collision with the box is enough to
        start it moving, but friction eventually brings the box and therefore
        also the finger to rest.  For large values, the finger will keep pushing
        the box until it runs into the far wall.</p>
      
      </example>

      <p>Consider the consequences of this behavior.  By commanding force, we
      can write a controller that will come into a nice contact with the box
      with essentially no information about the geometry of the box (we just
      need enough perception to start our finger in a location for which a
      straight-line approach will reach the box).</p>

      <p>This is one of the reasons that researchers working on legged robots
      like force control.  On a force-capable walking robot, we might mimic
      position control during the "swing phase", to get our foot approximately
      where we are hoping to step.  But then we switch to a force control mode
      to actually set the foot down on the ground.  This can significantly
      reduce the requirements for accurate sensing of the terrain.</p>

    </subsection>

    <subsection><h1>A force-based "flip-up" strategy</h1>

    </subsection>

    <subsection><h1>Indirect force control (impedance and admittance)</h1>
    
    </subsection>

    <subsection><h1>An impedance-based "flip-up" strategy</h1>
    
    </subsection>

  </section>

  <section><h1>Peg in hole</h1>

    <p>Call-out to the classic great example for force control.  Remote-centered
    compliance...</p>
  
    <p>Also for opening doors, tool use, ...</p>
  </section>

  <section><h1>Force control with the arm</h1>

    <subsection><h1>Direct Force Control</h1>

    </subsection>

    <subsection><h1>Impedance and Admittance Control</h1>
    
    </subsection>
  
  </section>

  <section><h1>Impedance control on the iiwa</h1>
  
  </section>

</chapter>
<!-- EVERYTHING BELOW THIS LINE IS OVERWRITTEN BY THE INSTALL SCRIPT -->

<table style="width:100%;"><tr style="width:100%">
  <td style="width:33%;text-align:left;"><a class="previous_chapter" href=segmentation.html>Previous Chapter</a></td>
  <td style="width:33%;text-align:center;"><a href=index.html>Table of contents</a></td>
  <td style="width:33%;text-align:right;"><a class="next_chapter" href=drake.html>Next Chapter</a></td>
</tr></table>

<div id="footer">
  <hr>
  <table style="width:100%;">
    <tr><td><a href="https://accessibility.mit.edu/">Accessibility</a></td><td style="text-align:right">&copy; Russ
      Tedrake, 2020</td></tr>
  </table>
</div>


</body>
</html>
